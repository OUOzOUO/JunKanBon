<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç·šä¸ŠçŒœæ‹³å¤§æˆ°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body class="bg-slate-100 flex flex-col items-center justify-center min-h-screen p-4 font-sans">

    <div id="setup-screen" class="bg-white p-8 rounded-xl shadow-lg w-full max-w-sm text-center">
        <h1 class="text-2xl font-bold mb-6 text-indigo-600">âœŒï¸ ç·šä¸ŠçŒœæ‹³å¤§æˆ°</h1>
        <button onclick="createNewRoom()" class="w-full bg-indigo-500 text-white py-3 rounded-lg mb-4 hover:bg-indigo-600 transition">å»ºç«‹æ–°æˆ¿é–“</button>
        <div class="flex gap-2">
            <input id="room-input" type="text" placeholder="è¼¸å…¥4ä½æˆ¿è™Ÿ" class="flex-1 border p-3 rounded-lg text-center">
            <button onclick="joinRoom()" class="bg-emerald-500 text-white px-4 py-3 rounded-lg hover:bg-emerald-600">åŠ å…¥</button>
        </div>
    </div>

    <div id="game-screen" class="hidden bg-white p-8 rounded-xl shadow-lg w-full max-w-sm text-center">
        <h2 id="display-room-id" class="text-sm text-gray-400 mb-2">æˆ¿é–“è™Ÿï¼š----</h2>
        <div id="status-msg" class="text-lg font-semibold mb-6 text-gray-700">ç­‰å¾…å°æ‰‹åŠ å…¥...</div>
        
        <div id="controls" class="grid grid-cols-3 gap-4 mb-8">
            <button onclick="play('çŸ³é ­')" class="text-4xl p-4 bg-gray-50 rounded-xl hover:bg-indigo-100 border-2 border-transparent focus:border-indigo-500">âœŠ</button>
            <button onclick="play('å‰ªåˆ€')" class="text-4xl p-4 bg-gray-50 rounded-xl hover:bg-indigo-100 border-2 border-transparent focus:border-indigo-500">âœŒï¸</button>
            <button onclick="play('å¸ƒ')" class="text-4xl p-4 bg-gray-50 rounded-xl hover:bg-indigo-100 border-2 border-transparent focus:border-indigo-500">ğŸ–ï¸</button>
        </div>

        <div id="result-area" class="hidden border-t pt-6">
            <div class="flex justify-around mb-4">
                <div><p class="text-xs text-gray-500">ä½ å‡ºäº†</p><p id="my-move" class="text-3xl">?</p></div>
                <div><p class="text-xs text-gray-500">å°æ–¹å‡º</p><p id="opp-move" class="text-3xl">?</p></div>
            </div>
            <div id="final-result" class="text-2xl font-black text-red-500 italic">è´äº†ï¼</div>
            <button onclick="location.reload()" class="mt-6 text-indigo-500 text-sm underline">å›é¦–é </button>
        </div>
    </div>

    <script>
        // --- âš ï¸ é‡è¦ï¼šè«‹åœ¨é€™è£¡å¡«å…¥ä½ çš„ Firebase è¨­å®š ---
        const firebaseConfig = {
              apiKey: "AIzaSyCkqnrJZWo66jXTUmLzs4iA-9HHhAJQ06A",
              authDomain: "junkanbon.firebaseapp.com",
              projectId: "junkanbon",
              storageBucket: "junkanbon.firebasestorage.app",
              messagingSenderId: "548450406216",
              appId: "1:548450406216:web:d5ce6a06f141b011a7ed7d",
              measurementId: "G-G324W6H3BV",
              // é€™æ˜¯æ‰‹å‹•è£œä¸Šçš„è³‡æ–™åº«ç¶²å€ï¼Œè«‹ç¢ºä¿ä½ åœ¨ Firebase æœ‰é–‹å•Ÿ Realtime Database
              databaseURL: "https://junkanbon-default-rtdb.firebaseio.com" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let currentRoom = null;
        let myRole = null; // 'player1' æˆ– 'player2'

        function createNewRoom() {
            const rid = Math.floor(1000 + Math.random() * 9000);
            myRole = 'player1';
            db.ref('rooms/' + rid).set({
                player1: { choice: "", status: "waiting" },
                player2: { choice: "", status: "waiting" }
            }).then(() => enterRoom(rid));
        }

        function joinRoom() {
            const rid = document.getElementById('room-input').value;
            if(!rid) return alert("è«‹è¼¸å…¥æˆ¿è™Ÿ");
            myRole = 'player2';
            enterRoom(rid);
        }

        function enterRoom(rid) {
            currentRoom = rid;
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('display-room-id').innerText = "æˆ¿é–“è™Ÿï¼š" + rid;
            listenRoom(rid);
        }

        function listenRoom(rid) {
            db.ref('rooms/' + rid).on('value', (snapshot) => {
                const data = snapshot.val();
                if(!data) return;

                const me = data[myRole];
                const opp = data[myRole === 'player1' ? 'player2' : 'player1'];

                // ç‹€æ…‹æ›´æ–°
                if(opp.status === 'ready' && me.status !== 'ready') {
                    document.getElementById('status-msg').innerText = "å°æ‰‹å·²å‡ºæ‹³ï¼å¿«é¸ä¸€å€‹ï¼";
                } else if(me.status === 'ready' && opp.status !== 'ready') {
                    document.getElementById('status-msg').innerText = "å·²å‡ºæ‹³ï¼Œç­‰å¾…å°æ‰‹...";
                }

                // åˆ¤å®šå‹è² 
                if(me.status === 'ready' && opp.status === 'ready') {
                    showResult(me.choice, opp.choice);
                }
            });
        }

        function play(move) {
            db.ref(`rooms/${currentRoom}/${myRole}`).update({
                choice: move,
                status: 'ready'
            });
            document.getElementById('controls').classList.add('pointer-events-none', 'opacity-50');
        }

        function showResult(myMove, oppMove) {
            document.getElementById('status-msg').innerText = "çµæœæ­æ›‰ï¼";
            document.getElementById('result-area').classList.remove('hidden');
            document.getElementById('my-move').innerText = moveEmoji(myMove);
            document.getElementById('opp-move').innerText = moveEmoji(oppMove);
            
            const res = judge(myMove, oppMove);
            document.getElementById('final-result').innerText = res;
        }

        function moveEmoji(m) {
            if(m === 'çŸ³é ­') return 'âœŠ';
            if(m === 'å‰ªåˆ€') return 'âœŒï¸';
            return 'ğŸ–ï¸';
        }

        function judge(me, opp) {
            if(me === opp) return "å¹³æ‰‹ï¼";
            if((me === 'çŸ³é ­' && opp === 'å‰ªåˆ€') || (me === 'å‰ªåˆ€' && opp === 'å¸ƒ') || (me === 'å¸ƒ' && opp === 'çŸ³é ­')) return "ä½ è´äº†ï¼ğŸ”¥";
            return "ä½ è¼¸äº†...ğŸ’€";
        }
    </script>
</body>
</html>
